<div class="container">
  <h2 class="mt-3 text-center party-title"><%= @party_session.title %></h2>
  <div class="d-flex justify-content-between">
  <% if current_user == @party_session.user %>
    <% if @party_session.end_date > DateTime.now %>
      <%= link_to "Edit Party", edit_party_session_path(@party_session) %>
      <%= link_to "Your Party Games", party_session_party_games_path(@party_session)%>
    <% end %>
      <%= link_to "Your Guests!", party_session_guests_path(@party_session) %>
  <% end %>
  </div>
  </div>
    <div class="my-4 party-sessions-card">
      <h4>Description</h4>
      <p><%= @party_session.description %></p>
      <h4>Address</h4>
      <p><%= @party_session.address%></p>
      <h4>Date and Time</h4>
      <p>Starts: <%= @party_session.start_date.strftime("%a %e %b, %Y at %l:%M%p")%> <br>Ends: <%= @party_session.end_date.strftime("%a %e %b, %Y at %l:%M%p")%></p>
      <div id="map" style="width: 100%; height: 175px; margin:auto; border-radius: 10px;"
        data-controller="mapbox"
        data-mapbox-markers-value="<%= @markers.to_json %>"
        data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"></div>
      <% if @party_session.end_date >= DateTime.now() %>
        <% if current_user == @party_session.user %>
          <div class="text-right">
            <%= link_to "Cancel", party_session_path(@party_session), method: :delete, data: {confirm: "Are you sure you want to cancel this event?"}, class: "text-red pr-1 mt-1" %>
          </div>
        <% else %>
          <% if @guest.confirm_availability %>
            <div class="bg-success p-2 rounded my-2 text-center">You accepted the invite. Have a blast!</div>
              <% if @party_session.start_date < DateTime.now %>
                  <%if @guest.confirm_arrival %>
                    <div class="text-right pt-2">
                      <%= link_to "I'm not here! ðŸ˜…", unconfirm_arrival_path(@party_session), method: :patch, class: "party-second-button text-red" %>
                    </div>
                  <% else %>
                    <div class="d-flex justify-content-between">
                      <%= link_to "I'm here! ðŸ¥³", confirm_arrival_path(@party_session), method: :patch, class: "party-second-button text-success" %>
                      <%= link_to "I changed my mind", unconfirm_availability_path(@party_session), method: :patch, data: {confirm: "Are you sure you no longer want to go?"}, class: "party-second-button text-red" %>
                    </div>
                  <% end %>
                <% end %>
          <% else @guest.confirm_availability %>
            <div class="d-flex justify-content-between mt-2 p-2">
              <%= link_to confirm_availability_path(@party_session), method: :patch, class: "text-success party-action-button" do%>
                <i class="fas fa-check"></i>
              <% end %>
              <%= link_to guest_path(@guest), method: :delete, data: {confirm: "Are you sure you don't want to go?"}, class: "party-action-button text-red" do%>
                <i class="fas fa-times"></i>
              <% end %>
            </div>
          <% end %>
        <% end %>
    <% end %>
    </div>
</div>
